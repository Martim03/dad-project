package dadkvs.server;

/* these imported classes are generated by the contract */
import dadkvs.DadkvsStep1;
import dadkvs.DadkvsStep1ServiceGrpc;
import io.grpc.stub.StreamObserver;

public class DadkvsStep1ServiceImpl extends DadkvsStep1ServiceGrpc.DadkvsStep1ServiceImplBase {

    CommitHandler commitHandler;

    public DadkvsStep1ServiceImpl(CommitHandler handler) {
        this.commitHandler = handler;

    }

    @Override
    public void commitorder(DadkvsStep1.commitOrderRequest request, StreamObserver<DadkvsStep1.commitOrderReply> responseObserver) {

        int order = request.getOrderNum();
        int reqid = request.getReqid();

        System.out.println("Receiving commit order request: order " + order + " reqid " + reqid);

        commitHandler.addOrderedRequest(order, reqid);

        DadkvsStep1.commitOrderReply response = DadkvsStep1.commitOrderReply.newBuilder().build();

        responseObserver.onNext(response);
        responseObserver.onCompleted();
    }
}
